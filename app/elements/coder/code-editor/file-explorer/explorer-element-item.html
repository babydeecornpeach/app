<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">

<dom-module id="explorer-element-item">
	<template>
		<style include="iron-flex">
			.children {
				padding-left: 20px;
			}
		</style>
		<div >
			<template id="repeat" is="dom-repeat" items="{{childItems}}">
				<file-item item="[[item]]" path="[[path]]"></file-item>
				<template is="dom-if" if="{{!isFile(item)}}">
					<div class="children">
						<explorer-element-item node="{{item.value}}" path="{{getPath(item)}}"></explorer-element-item>
					</div>
				</template>
			</template>
		</div>
	</template>
	<script>
		Polymer({
			is: 'explorer-element-item',
			properties: {
				node: {
					reflectToAttribute: true,
					notify: true,
					observer: '_nodeChanged'
				},
				path: {
					reflectToAttribute: true,
					notify: true
				},
				childItems: {
					type: Array,
					notify: true
				}
			},
			observers: [
				'_nodeChanged(node, path)'
			],
			getPath: function(item){
				return this.path + item.name + '/';
			},
			isFile: function(item){
				return !(typeof item.value === 'object');
			},
			_nodeChanged: function(){
				if(!this.path){
					return;
				}
				this.childItems = this._toArray(this.node);
				this.$.repeat.render();
			},
			_toArray: function(obj){
				if(!obj){
					return;
				}
				return Object.keys(obj).map(function(key) {
					return {
						name: key,
						value: obj[key]
					};
				});
			}
		});
	</script>
</dom-module>
