<script src="../bower_components/page/page.js"></script>
<script src="../scripts/util.js"></script>
<script src="../bower_components/js-base64/base64.js"></script>
<script>
  window.addEventListener('WebComponentsReady', function() {
    page('/token/:token', function(context){
      var token = context.params.token;
      if (Base64.extendString) {
        Base64.extendString();
        var decodedToken = token.fromBase64().split(":");
        document.cookie = "token=" + decodedToken[1];
        document.cookie = "loggedIn=true";
        app.requestData(decodedToken[0]);
      }
      page.redirect("/codingGround")
    });

    page('/codingGround', function () {
      checkLoggedIn();
      app.route = 'codingGround';
      app.header = "Coding ground"
    });

    page('/unauthorized', function(){
      app.route = 'unauthorized';
    });

    // add #! before urls
    page({
      hashbang: true
    });

    function checkLoggedIn(){
      var loggedIn = getCookie("loggedIn")
      if(loggedIn=="" || loggedIn=="false"){
        page.redirect("/unauthorized")
      }
    }
  });
</script>
