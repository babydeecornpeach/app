<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="sequential-challenge">
  <template>
    <template is="dom-if" if="{{showForwardArrow}}">
      <paper-icon-button icon="arrow-forward" style="position: absolute; right: 2%; bottom: 2%;"></paper-icon-button>
    </template>
    <template is="dom-if" if="{{showBackArrow}}">
      <paper-icon-button icon="arrow-back" style="position: absolute; left: 2%; bottom: 2%;"></paper-icon-button>
    </template>
    <div id="content">
      <paper-material elevation="1" style="width:35%;">
        <div class="flex">
          <challenge-display challenge="{{challenge}}"></challenge-display>
          <paper-button raised on-click="startChallenge">Go</paper-button>
        </div>
      </paper-material>
    </div>
    <iron-ajax
      id="loadTaskRequest"
      handle-as="json"
      on-response="onTaskResponse"
      debounce-duration="1000"
      content-type="application/json"
      >
    </iron-ajax>
  </template>
  <script>
    Polymer({
      is: 'sequential-challenge',
      properties: {
        challenge: {
          type: Object,
          notify: true,
          reflectToAttribute: true
        },
        task: {
          type: Object,
          notify: true
        },
        taskIndex: {
          type: Number,
          notify: true
        }
      },
      ready: function(){
        this.showForwardArrow = false;
        this.showBackArrow = false;
      },
      startChallenge: function(){
        this.taskIndex = 0;
        this.loadTaskById(this.challenge.Tasks[this.taskIndex]);
      },
      loadTaskById: function(key){
        get(this.$.loadTaskRequest, "/task/" + key + "?result=" + localStorage.getItem("result"));
      },
      onTaskResponse: function(r){
        var task = r.detail.response
        var webInterface = document.createElement(task.Endpoints.WebInterface);
        webInterface.task = task;
        this.$.content.innerHTML = "";
        this.$.content.appendChild(webInterface);
      },
      displayArrows: function(){
        this.showBackArrow = this.taskIndex > 0;
        this.showForwardArrow = this.taskIndex < this.challenge.Tasks.length;
      }
    });

  </script>
</dom-module>
