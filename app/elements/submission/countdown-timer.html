<dom-module id="countdown-timer">
	<style>
		p{
			margin: 0;
			padding: 0;
		}
	</style>
	<template>
			<div>
				<p>{{formatedDuration}}</p>
			</div>
	</template>
	<script>
		Polymer({
			is: 'countdown-timer',
			properties: {
				duration: {
					type: Number,
					notify: true,
					reflectToAttribute: true
				},
				tickInterval: {
					type: Number
				},
				formatedDuration: {
					type: String,
					notify: true
				}
			},
			_formatDuration: function() {
				var d = this.duration / 1e9;
				var h = Math.floor(d / 3600) % 24;
				var m = Math.floor(d / 60 % 60);
				var s = Math.floor(d % 60);
				this.formatedDuration = ('0' + h).slice(-2) + ':' +  ('0' + m).slice(-2) + ':' + ('0' + s).slice(-2);
			},
			start: function() {
				if (this.duration <= 0) {
					this.timeout();
					return;
				}

				if (!this.tickInterval) {
					var component = this;
					this.tickInterval = window.setInterval(function(){
						component.tick();
					}, 1000);
				}
			},
			startWithOffset: function(offset) {
				this.duration -= (Date.now() - offset) * 1e6;
				this.start();
			},
			tick: function() {
				if (this.duration <= 0) {
					clearInterval(this.tickInterval);
					this.timeout();
				}
				this.duration -= 1e9;
				this._formatDuration();
			},
			timeout: function() {
				localStorage.removeItem('timer');
				this.fire('timeout');
				return;
			}
		});
	</script>
</dom-module>
