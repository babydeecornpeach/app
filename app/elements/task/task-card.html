<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/elements/skill/skill-list.html">

<dom-module id="task-card">
	<style>
		:host {
			width: 350px;
			height: 250px;
			margin: 0 10px 10px 0;
		}

		paper-material {
			width: 100%;
			height: 100%;
			padding: 0;
		}

		#content{
			width: calc(100% - 32px);
			height: calc(100% - 32px);
			padding: 16px;
			overflow: hidden;
		}

		#content h2, div {
			margin: 7px;
		}

		.taskDuration iron-icon {
			height: 20px;
			width: 20px;
		}

		.task-selector {
			position: absolute;
			top: 10px;
			right: 10px;
		}

		a {
			text-decoration: none;
		}
	</style>
	<template>
		<paper-material
			id="task"
			animated
			elevation="{{elevation}}"
			class="card"
			on-mouseover="onHovered"
			on-mouseout="onUnhovered"
	  	>
			<template is="dom-if" if="{{showSelect}}">
				<paper-icon-button id="taskSelector" class="task-selector"
				icon="{{selectorIcon}}" on-click="_toggleSelectTask" style$="{{addButtonStyle}}"></paper-icon-button>
			</template>
			<div id="content" on-click="_viewTaskDetail">
				<h2>{{task.Assignment.Name}}</h2>
				<div class="taskDuration">
					<iron-icon icon="alarm"></iron-icon>
					<span>{{duration}}</span>
				</div>
				<skill-list skill-weights="{{task.SkillWeights}}"></skill-list>
			</div>
		</paper-material>
	</template>
	<script>
		Polymer({
			is: 'task-card',
			properties: {
				noSelect: {
					type: Boolean,
					notify: true,
					value: false
				},
				task: {
					type: Object,
					notify: true
				},
				duration: {
					type: String,
					computed: '_computeDuration(task)'
				},
				showSelect: {
					type: Boolean,
					notify: true
				},
				selectionView: {
					type: Boolean,
					notify: true,
					observer: '_selectionViewObserver'
				},
				elevation: {
					type: Number,
					notify: true,
					value: 1
				},
				addButtonStyle: {
					type: String,
					notify: true,
					value: 'color: gray;'
				},
				selected: {
					type: Boolean,
					notify: true,
				},
				selectorIcon: {
					type: String,
					notify: true,
					value: 'check-circle'
				}
			},
			ready: function(){
				this.goTo = '/tasks/' + this.task.Key;
			},
			onHovered: function () {
				this.showSelect = !this.noSelect && true;
				this.elevation = 5;
			},
			onUnhovered: function () {
				this.showSelect = this.selectionView || false;
				this.elevation = this.selectionView && this.selected ? 5 : 1;
			},
			_toggleSelectTask: function () {
				this.selected = !this.selected;
				if(this.selected){
					this.addButtonStyle = 'color: #4285f4;';
					this.selectorIcon = 'check-circle';
					this.elevation = 5;
					this.fire('task-added', this.task);
				}else{
					this.addButtonStyle = 'color: gray;';
					this.selectorIcon = 'radio-button-unchecked';
					this.elevation = 1;
					this.fire('task-removed', this.task);
				}
			},
			_computeDuration: function (task) {
				return util.computeDuration(task.Assignment.Duration);
			},
			_selectionViewObserver: function () {
				this.showSelect = this.selectionView;
				if(!this.selectionView){
					this.selectorIcon = 'check-circle';
				}
				if(this.showSelect && !this.selected){
					this.selectorIcon = 'radio-button-unchecked';
				}
			},
			_viewTaskDetail: function(){
				if(!this.selectionView){
					page.redirect('/tasks/' + this.task.Key);
				}else{
					this._toggleSelectTask();
				}
			}
		});
	</script>
</dom-module>
