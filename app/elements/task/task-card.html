<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/elements/skill/skill-list.html">

<dom-module id="task-card">
	<style>
		:host {
			width: 350px;
			height: 250px;
			margin: 0 10px 10px 0;
		}

		paper-material {
			width: calc(98.66% - 32px);
			height: calc(98.66% - 32px);
			padding-right: 35px;
			overflow: hidden;
		}

		paper-material h2, div {
			margin: 7px;
		}

		.taskDuration iron-icon {
			height: 20px;
			width: 20px;
		}

		paper-fab {
			width: 24px;
			height: 24px;
			--paper-fab-background: rgba(148, 167, 206, 0.5)
		}

		.task-selector {
			position: absolute;
			top: 10px;
			right: 10px;
		}

		.task-detail {
			position: absolute;
			top: 50px;
			right: 10px;
		}
	</style>
	<template>
		<paper-material
			id="task"
			elevation="2"
			class="card"
			on-mouseover="onHovered"
			on-mouseout="onUnhovered"
	  	>
			<h2>{{task.Name}}</h2>
			<template is="dom-if" if="{{showButton}}">
				<paper-fab class="task-selector" icon="add" on-click="_toggleSelectTask"></paper-fab>
			</template>
			<template is="dom-if" if="{{showZoomButton}}">
				<paper-fab class="task-detail" icon="zoom-in" on-click="_viewTaskDetail"></paper-fab>
			</template>
			<div class="taskDuration">
				<iron-icon icon="alarm"></iron-icon>
				<span>{{duration}}</span>
			</div>
			<skill-list skill-weights="{{task.SkillWeights}}"></skill-list>
		</paper-material>
	</template>
	<script>
		Polymer({
			is: 'task-card',
			properties: {
				task: {
					type: Object,
					notify: true
				},
				duration: {
					type: String,
					computed: '_computeDuration(task)'
				},
				selectedTasks: {
					type: Array,
					notify: true,
					observer: '_selectedTasksCleared'
				},
				showButton: {
					type: Boolean,
					notify: true
				},
				showAllButtons: {
					type: Boolean,
					notify: true,
					observer: '_globalValueChanged'
				},
				showZoomButton: {
					type: Boolean,
					notify: true
				},
				noSelect: {
					type:Boolean,
					notify: true,
					value: false
				}
			},
			onHovered: function () {
				this.showButton = !this.noSelect;
				this.showZoomButton = true;
			},
			onUnhovered: function () {
				this.showZoomButton = false;
				this.showButton = this.showAllButtons || false;
			},
			_toggleSelectTask: function () {
				if (this.noSelect){
					return;
				}
				var index = this.selectedTasks.indexOf(this.task);
				if (index !== -1) {
					this.$.task.style.border = '';
					this.splice('selectedTasks', index, 1);
				} else {
					this.$.task.style.border = 'solid #000000';
					this.push('selectedTasks', this.task);
				}
				if (this.selectedTasks.length > 0) {
					this.showAllButtons = true;
					app.header = this.selectedTasks.length + ' SELECTED';
				}
				else {
					this.showAllButtons = false;
					app.header = 'Tasks';
				}
			},
			_selectedTasksCleared: function (newValue) {
				if (newValue.indexOf(this.task) === -1) {
					this.$.task.style.border = '';
				}
			},
			_computeDuration: function (task) {
				return util.computeDuration(task.Duration);
			},
			_globalValueChanged: function (newValue) {
				this.showButton = newValue;
			},
			_viewTaskDetail: function(){
				page.redirect('/tasks/' + this.task.Key);
			}
		});
	</script>
</dom-module>
